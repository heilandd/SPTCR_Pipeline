(SPTCR_ENV) jkbuntu@jkbuntu-XPS-15-9500:./Testing_Zone/Final$ bash "./Testing_Zone/Final/FINAL_CORR.sh"
SampleX
################## PreProcessing SampleX ########################
 :::: Checking Fastq Integrity ::::
2022-07-10 : 19-40-49
 :::: Pychopper ::::
2022-07-10 : 20-50-12
 :::: Trimming Adapters with Cutadapt ::::
Extracting 10X Amplicon (R1,TSO) of Reads
Done           00:03:43     8,489,230 reads @  26.3 µs/read;   2.28 M reads/minute
Trimming remaining R1 or TSO on either Side Reads for chimeric Reads/PCR Artifacts
Done           00:02:03     8,489,230 reads @  14.5 µs/read;   4.13 M reads/minute
 :::: Checking Fastq Integrity ::::
 :::: Quering (trimmed) Input to IgBlast for vdj Clustering :::: 
Splitting input fastq file ./Out_Folder/PreProcessing/CUTADAPT/SampleX_Cutadapt_trimmed.fastq_sana
8,487,281 sequences successfully split into 8488 pieces
Starting process pool using 24 processors
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8487281/8487281 [3:04:43<00:00, 765.76seq/s]
8,487,281 sequences processed in 11,282.32 seconds, 752 sequences / s
Analysis complete, result file: SampleX_preprocessed_IGB.tsv
 ::::: Cleaning Up :::::
 ::::: Demultiplexing Output :::::
Using ./Out_Folder/PreProcessing/LOGS as Log Folder
2022-07-11 : 00-10-30
 :::: Demultiplexing & Extracting UMIs with scTagger::::
:::::Demultiplexing and UMI Extraction :::::
::: Extracting Adapter and Barcode :::
::: Extracting Adapter, Barcode and UMI:::
::::: Extracting Long Read Adapter Segments :::::
::::: Matching Barcodes to Extracted Segments :::::
Namespace(long_read_segments='./Out_Folder/PreProcessing/Demultiplexing_SampleX/SampleX_DEMUX/SampleX_lr_bc.tsv.gz', short_read_barcodes='./Github SPTCR-seq Pipeline/SPTCR-Seq-Pipeline/Reference/Barcodes/visium_bc.tsv', max_error=2, mem=60.0, barcode_length=16, threads=24, plotfile=None, outfile='./Out_Folder/PreProcessing/Demultiplexing_SampleX/SampleX_DEMUX/SampleX_scTagger_DEMUX.tsv.gz')
Reading short reads barcodes
There are 4,992 SR barcodes
Reading long reads barcodes
There are 11,262,960 LRs
[(2, b'AAA'), (2, b'AAC'), (2, b'AAG'), (2, b'AAT'), (2, b'ACA'), (2, b'ACC'), (2, b'ACG'), (2, b'ACT'), (2, b'AGA'), (2, b'AGC'), (2, b'AGG'), (2, b'AGT'), (2, b'ATA'), (2, b'ATC'), (2, b'ATG'), (2, b'ATT'), (2, b'CAA'), (2, b'CAC'), (2, b'CAG'), (2, b'CAT'), (2, b'CCA'), (2, b'CCC'), (2, b'CCG'), (2, b'CCT'), (2, b'CGA'), (2, b'CGC'), (2, b'CGG'), (2, b'CGT'), (2, b'CTA'), (2, b'CTC'), (2, b'CTG'), (2, b'CTT'), (2, b'GAA'), (2, b'GAC'), (2, b'GAG'), (2, b'GAT'), (2, b'GCA'), (2, b'GCC'), (2, b'GCG'), (2, b'GCT'), (2, b'GGA'), (2, b'GGC'), (2, b'GGG'), (2, b'GGT'), (2, b'GTA'), (2, b'GTC'), (2, b'GTG'), (2, b'GTT'), (2, b'TAA'), (2, b'TAC'), (2, b'TAG'), (2, b'TAT'), (2, b'TCA'), (2, b'TCC'), (2, b'TCG'), (2, b'TCT'), (2, b'TGA'), (2, b'TGC'), (2, b'TGG'), (2, b'TGT'), (2, b'TTA'), (2, b'TTC'), (2, b'TTG'), (2, b'TTT')]
Running get_matches_prefix on 24 threads and 64 tasks
Memory usage: 8.58GB
::::: Generating Final Output Table :::::
:::::: Removing Intermediate Folders :::::
:::::: Generating IGB with UMI :::::
Reading only columns with names: ['sequence_id', 'locus', 'v_call', 'd_call', 'j_call', 'cdr3', 'cdr3_aa']
VDJ Dataframe with UMIs: 
                                        ReadID Locus                V         D           J CDR3 CDR3_aa   Spatial Barcode           UMI
0        8ca0f0fc-6694-405d-93d4-ba7f059a1313   TRA       TRBV5-1*02       NaN   TRAJ40*01  NaN     NaN  AAATTGATAGTCCTTT  TGATTATAGTTG
1        1d62aac7-dc76-4e88-b653-6cc695d2390d   TRG      TRBV11-1*01       NaN         NaN  NaN     NaN  GTTGAGGACCGCAACT  CGCTGTCCAGAT
2        c3947160-22c3-41da-adfa-2f2850e0aab9   TRA    TRAV29/DV5*01       NaN   TRAJ37*01  NaN     NaN  GTCTAGGGACGGAAGC  TAATAGATTAGT
3        c6b0e97b-360f-4f05-a87a-8ffe525b3f5e   TRB      TRAV12-1*02       NaN  TRBJ2-3*01  NaN     NaN  CAGCTGGCGTAACCGT  GTTACATTGGTG
4        91397e9b-608c-449e-ab69-f5f4c9572831   TRB        TRBV14*01       NaN  TRBJ1-6*01  NaN     NaN  TAATTCCAATGCTTCA  GGGGGGGTGATG
...                                       ...   ...              ...       ...         ...  ...     ...               ...           ...
7596568  276af8d7-9cee-4cd6-b938-7e931d03d0d5   TRB       TRBV5-1*01       NaN  TRBJ1-1*01  NaN     NaN  ATAGCAGCTCATTGTG  AAATCATACTGT
7596569  e4cc46b7-de24-4ea1-9b6c-4d80b3b09890   TRB        TRAV30*05       NaN  TRBJ2-2*01  NaN     NaN  GGGACGTAAAGGTCCG  GGGGCGGCGATT
7596570  13223ec5-5f7b-4741-aa5a-67efbce49510   TRA  TRBV23/OR9-2*01       NaN   TRAJ38*01  NaN     NaN  CTGGAAGACACGGTGG  GCGATGGCCAGG
7596571  f180c323-b7a6-4356-ae7b-a87690babb91   TRA         TRAV2*01       NaN   TRAJ27*01  NaN     NaN  CAATGGAATCTACATA  ACTAGGTGGTCA
7596572  38c51cb2-adad-4423-b177-9a5b599bd2c3   TRB        TRBV14*01  TRBD1*01  TRBJ2-2*01  NaN     NaN  GTGCACGCTTGATCAC  TGGCATTGGAAT

[7596573 rows x 9 columns]
################## Correcting SampleX ########################
Using: locus,v_family as Grouper
 :::: Checking Fastq Integrity ::::
 :::: Clustering Reads by VJ Arrangement ::::
Grouping TCRs by: ['locus', 'v_family'] Using ReadIds from Column: sequence_id
Reading in IgBlast Result and preparing it
Only Reading: ['locus', 'v_family', 'sequence_id']
                                             locus      v_family
sequence_id                                                     
28:488|8ca0f0fc-6694-405d-93d4-ba7f059a1313    TRA       TRBV5-1
27:709|1d62aac7-dc76-4e88-b653-6cc695d2390d    TRG      TRBV11-1
31:1210|6278756d-99f9-4793-9fcc-fcda582b961b   TRA        TRAV34
25:1063|4a57d03b-9af9-4e2b-b07f-e31764bece1c   TRB      TRBV23-1
35:640|c3947160-22c3-41da-adfa-2f2850e0aab9    TRA    TRAV29/DV5
...                                            ...           ...
35:291|276af8d7-9cee-4cd6-b938-7e931d03d0d5    TRB       TRBV5-1
22:687|e4cc46b7-de24-4ea1-9b6c-4d80b3b09890    TRB        TRAV30
35:425|13223ec5-5f7b-4741-aa5a-67efbce49510    TRA  TRBV23/OR9-2
29:1247|f180c323-b7a6-4356-ae7b-a87690babb91   TRA         TRAV2
26:760|38c51cb2-adad-4423-b177-9a5b599bd2c3    TRB        TRBV14

[8380748 rows x 2 columns]
Process based parallel writing of TRB VDJ Clusters 01:07:24.703215
Finished parallel writing of TRB Clusters 01:20:06.127810
Process based parallel writing of TRD VDJ Clusters 01:20:06.127878
Finished parallel writing of TRD Clusters 01:20:50.721267
Process based parallel writing of VJ Clusters 01:20:50.721290
Finished parallel writing of TRA Clusters 01:33:34.848557
Process based parallel writing of VJ Clusters 01:33:34.848959
Finished parallel writing of TRG Clusters 01:35:18.079634
2022-07-11 : 01-35-31
 :::: Parallel Correcting Fastq. Memory intensive!! ::::
parallel: Warning: Only enough file handles to run 252 jobs in parallel.
parallel: Warning: Try running 'parallel -j0 -N 252 --pipe parallel -j0'
parallel: Warning: or increasing 'ulimit -n' (try: ulimit -n `ulimit -Hn`)
parallel: Warning: or increasing 'nofile' in /etc/security/limits.conf
parallel: Warning: or increasing /proc/sys/fs/file-max
100% 450:0=0s ./Out_Folder/ClusterCorrect/IGB_CLUSTERS/TRG_TRBV9.fastq       
2022-07-11 : 06-57-38
 :::: Parallel Merge Corrected Fastqs ::::
parallel: Warning: Only enough file handles to run 252 jobs in parallel.
parallel: Warning: Try running 'parallel -j0 -N 252 --pipe parallel -j0'
parallel: Warning: or increasing 'ulimit -n' (try: ulimit -n `ulimit -Hn`)
parallel: Warning: or increasing 'nofile' in /etc/security/limits.conf
parallel: Warning: or increasing /proc/sys/fs/file-max
100% 449:0=0s ./Out_Folder/ClusterCorrect/CORRECTION/RATTLE_CORRECT/TRA_TRAV9
 :::: Checking Fastq Integrity & renaming Corr Fastq ::::
 :::: Quering corrected Fastq to IGB :::: 
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 5378490/5378500 [1:54:03<00:00, 785.92seq/s]
 :::: Moving Output Files to the Front ::::
 :::: Keeping all Intermediate Files ::::
 :::: Generate the VDj Annotation Summary ::::
Reading only columns with names: ['sequence_id', 'locus', 'v_call', 'd_call', 'j_call', 'cdr3', 'cdr3_aa']
VDJ Dataframe with UMIs: 
                                        ReadID Locus          V    D           J CDR3 CDR3_aa   Spatial Barcode           UMI
0        a6fff8c4-f863-414f-a030-4464f12167c9   TRA  TRAV20*01  NaN   TRAJ20*01  NaN     NaN  AGTCTTAAGGGTAACT  TAGGTTATATGT
1        431fac21-faa0-413f-937c-002efe5bac61   TRA  TRAV20*01  NaN   TRAJ20*01  NaN     NaN  CTAGCATTAATAGAAG  ATGCCATGGGTT
2        5c562c6e-abf1-4bbf-bdf1-2277221ee241   TRA  TRAV20*01  NaN   TRAJ20*01  NaN     NaN  TATTCCGAGCTGTTAT  TACGTTTCGTTT
3        db40e1c9-389a-4399-a04f-7373d3f88b0a   TRA  TRAV20*01  NaN   TRAJ20*01  NaN     NaN  AGCTTGTGGATTTATA  TTCCTTGGCTTT
4        ec9e1be3-2151-4594-afd9-7c1248ed2d69   TRA  TRAV20*01  NaN   TRAJ20*01  NaN     NaN  AGTTACCCTTAAGACT  TCTAGGTTATAT
...                                       ...   ...        ...  ...         ...  ...     ...               ...           ...
4823169  9597b9ec-5f08-4422-98e3-5085d3f3e35d   TRB   TRBV2*01  NaN  TRBJ1-2*01  NaN     NaN  TCATAATCGGATGGCG  GATGGGCAAGGT
4823170  77bc1a6f-1e33-47a5-b907-09618d2eb20a   TRB   TRBV2*01  NaN  TRBJ1-2*01  NaN     NaN  GCTCGCGGTTCCGCTC  CATGGTACTTAG
4823171  a4a1bb48-89f6-403e-aedb-20b473946004   TRB   TRBV2*01  NaN  TRBJ1-2*01  NaN     NaN  GAGTGGGTGGAACTAT  TGGGTGCACTGT
4823172  c324b6bc-7bf6-40b5-aa07-a3a305798195   TRB   TRBV2*01  NaN  TRBJ1-2*01  NaN     NaN  AATCCAAGGGCCTGAG  GTTCACAGTGAG
4823173  66cc7bd6-8f80-4d37-b568-62ae305bbca5   TRB   TRBV2*01  NaN  TRBJ1-2*01  NaN     NaN  CATGCGACCAGTTTAA  AGGATATTGTAC

[4823174 rows x 9 columns]
 :::: Performing UMI Correction on Summary ::::
         Spatial Barcode  Uncorrected Count UMI Corrected Locus            V         D           J        CDR3_aa
0       TCTGGACATTTGCGCG              14684            70   TRB  TRBV21-1*01  TRBD1*01  TRBJ2-7*01    ASKDRALLRAV
1       CGCGCAAATGTCCAGA              12790            77   TRB  TRBV21-1*01  TRBD1*01  TRBJ2-7*01    ASKDRALLRAV
2       CAGAGAAGTCTTGGTT              11974            85   TRB   TRBV7-8*01  TRBD2*01  TRBJ2-2*01  ASSPGEQNTGELF
3       AACCAAGACTTCTCTG              10426            65   TRB   TRBV7-8*01  TRBD2*01  TRBJ2-2*01  ASSPGEQNTGELF
4       TGATTAAAGCCATCTC               9367            78   TRB     TRBV2*01  TRBD1*01  TRBJ2-7*01    ASSARQDLQQY
...                  ...                ...           ...   ...          ...       ...         ...            ...
266589  ACGTTAGATTTGCCCG                  1             1   TRA    TRAV22*01             TRAJ23*01       THNIL*KL
266590  AAGCGTAGAACGCAGG                  1             1   TRA    TRAV22*01             TRAJ23*01       THNIL*KL
266591  AACCCTGGTGGAACCA                  1             1   TRA    TRAV22*01             TRAJ23*01       THNIL*KL
266592  AACCCGACAACCCGTG                  1             1   TRA    TRAV22*01             TRAJ23*01       THNIL*KL
266593  TCATTTAGGTCTGTAA                  1             1   TRA     TRBV9*03             TRAJ20*01          IKL*R

[266594 rows x 8 columns]
Done with SPTCR-seq Correction Pipeline. Corrected IgBlast Overview File is in ./Out_Folder/ClusterCorrect/SampleX_corr_igb_overview_igb.csv, UMI Corrected Summary Counts are in ./Out_Folder/ClusterCorrect/SampleX_igb_corr_umi_corrected.csv